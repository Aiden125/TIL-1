<!-- TOC -->

- [1장 IoC 컨테이너와 DI](#1장-ioc-컨테이너와-di)
    - [컨테이너: 빈 팩토리와 애플리케이션 컨텍스트](#컨테이너-빈-팩토리와-애플리케이션-컨텍스트)
    - [설정 메타 정보](#설정-메타-정보)
    - [웹 애플리케이션의 컨텍스트 구성 방법](#웹-애플리케이션의-컨텍스트-구성-방법)
        - [서블릿 컨텍스트와 루트 애플리케이션 컨텍스트 계층 구조](#서블릿-컨텍스트와-루트-애플리케이션-컨텍스트-계층-구조)
        - [루트 애플리케이션 컨텍스트 단일구조](#루트-애플리케이션-컨텍스트-단일구조)
        - [서블릿 컨텍스트 단일구조](#서블릿-컨텍스트-단일구조)
    - [IoC/DI를 위한 빈 설정 메타정보 작성](#iocdi를-위한-빈-설정-메타정보-작성)
    - [스코프](#스코프)
        - [스코프의 종류](#스코프의-종류)
        - [요청 스코프](#요청-스코프)
        - [세션 스코프, 글로벌세션 스코프](#세션-스코프-글로벌세션-스코프)
        - [애플리케이션 스코프](#애플리케이션-스코프)
    - [스포프 빈의 사용 방법](#스포프-빈의-사용-방법)
    - [정리](#정리)
- [2장 데이터 액세스 기술](#2장-데이터-액세스-기술)
    - [공통 개념](#공통-개념)
        - [DAO 패턴](#dao-패턴)
        - [DAO 인터페이스와 DI](#dao-인터페이스와-di)
    - [DataSoruce](#datasoruce)

<!-- /TOC -->

# 1장 IoC 컨테이너와 DI

## 컨테이너: 빈 팩토리와 애플리케이션 컨텍스트
스프링 애플리케이션에서 오브젝트의 생성과 관계설정, 사용, 제거 등의 작업을 애플리케이션 코드 대신에 독립된 컨테이너가 담당한다. 이를 컨테이너가 코드를 대신 오브젝트에 대한 제어권을 갖고 있다고 해서 IoC 라고 부른다. 그래서 스프링 컨테이너를 IoC 컨테이너라고도 한다.
스프링에선 IoC를 담당하는 컨테이너를 빈 팩토리 또는 애플리케이션 컨텍스트라고 부르기도 한다. 오브젝트의 생성과 오브젝트 사이의 런타임 관계를 서정하는 DI 고나점으로 볼 떄는 컨테이너를 빈 팩토리라고 한다. 그런데 스프링 컨테이너는 단순한 DI 작업 보다 더 많은 일을 한다. DI를 위한 빈 백토리에 엔터프라이즈 애플리케이션을 개발하는 데 필요한 여러 가지 컨테이너 기능을 추가한 것을 애플리케이션 컨텍스트라고 부른다. **즉 애플리케이션 컨텍스트는 그 자체로 IoC와 DI를 위한 빈 팩토리이면서 그 이상의 기능을 가젹ㅆ다고 보면 된다.**

## 설정 메타 정보
IoC 컨테이너의 가장 기초적인 영할은 오브젝트를 생성하고 이를 관리하는 것이다. 스프링 컨테이너가 관리하는 이런 오브젝트를 빈 이라고 부른다. IoC 컨테이너가 필요로 하는 설정 메타정보는 바로 이 빈을 어떻게 동작하게 할 것인가에 대한 정보이다.

스프링 IoC 컨에티너는 각 빈에 대한 정보를 담은 설정 메타정보를 읽어들인 뒤에, 이를 참고해서 빈 오브젝트를 생성하고 프로퍼티나 생성자를 통해서 의존 오브젝트를 주입해주는 DI 작업을 수행한다.
IoC 컨에티너가 사용하는 빈 메타 정보는 대략 다음과 같다.
* 빈 아이디, 이름, 별칭: 빈 오브젝트를 구분할 수 있는 식별자
* 클래스 또는 클래스 이름: 빈으로 만들 POJO 클래스 또는 서비스 클래스 정보
* 스코프: 싱글톤, 프로톹입 같은 빈 생성 방식과 존재 범위
* 르포러티 값 또는 참조: DI에서 사용할 프로퍼티 이름과 값 또는 참조하는 빈의 이름
* 생성자 파라미터 값 또는 참조: DI 사용할 생성자 파라미터 이름과 값 또는 참조할 빈의 이름
* 지연된 로딩 여부, 우선 빈 여부, 자동와이어링 여부, 부모 빈 정보, 빈팩토리 이름등

스프링 IoC 컨에티너는 각 빈에 대한 ㅈ어보를 담은 설정 메타정보를 읽어드린 뒤에, 이를 참고해서 빈 오르벡트를 생서하고 프로퍼티나 생성자를 통해 의존 오브젝트를 주깁해주는 DI 작업을 수행한다. 
이작업을 통해 만들어지고, DI로 연결되는 오브젝트들이 모여서 하나의 애플리케이션을 구성하고 동작하게 된다. IoC 컨에티너의 역활이 바로 그것이다.

**결국 스프링 애플리케이션이란 POJO 클래스와 설저 메타정보를 이용해서 IoC 컨테이너가 만들어주는 오브젝트의 조합이라고 할 수있다.**  일반적으로 설정 메타정보는 XML 파일이나 애노테이션 같은 외부 리소스를 전용리더가 읽어서 BeanDefinition 메타정보를 생성할 수도 있다.

구현 클래스들은 인터페이스를 사이를 두고 아주 느슨하고 간접적인 관계를 맺고 있어야 한다.

## 웹 애플리케이션의 컨텍스트 구성 방법
웹 애플리케이션의 애플리케이션 컨텍스트를 구성하는 방법으로는 당므 세 가지를 고려해볼 수 있다. 첫 번째 방법은 컨텍스트 계층구조를 만드는것이고, 나머지 두 가지 방법은 컨텍스트를 하나만 사용하는 방법이다. 첫 번째와 세 번째 방법은 스프링 웹 기능을 사용하는 경우고, 두 번때 방법은 스프링 웹기술을 사용하지 않을 때 적용 가능한 방법이다.

### 서블릿 컨텍스트와 루트 애플리케이션 컨텍스트 계층 구조
가장 많이 사용되는 기본적인 구성방법이다. 스프링 웹 기술을 사용하는 경우 웹관련 빈들을 서블릿의 컨텍스트에 두고 나머지는 루트 애플리케이션 컨텍스트에 등록 한다. 루트 컨텍스트는 모든 서블릿 레벨 컨텍스트의 부모 컨텍스트가 된다. 

### 루트 애플리케이션 컨텍스트 단일구조
스프링 웹 기술을 사용하지 않고 서드파티 웹 프레임워크나 서비스 엔진만을 사용해서 프리젠테이션 계층을 만든다면 스프링 서블릿을 둘 이유가 없다. 따라서 서블릿의 애플리케이션 컨텍스트를 사용하지 않아도된다. 이떄는 루트 애플리케이션 컨텍스트만 등록해주면 된다.

### 서블릿 컨텍스트 단일구조
스프링 웹 기술을 사용하면서 스프링 외의 프레임워크나 서비스 엔진에서 스프링의 빈을 아요할 생각이 아니라면 루트 애플리케이션 컨텍스트를 생략할 수 있다.

## IoC/DI를 위한 빈 설정 메타정보 작성
IoC 컨테이너의 가장 기본적인 역할은 코드를 대신해서 애플리케이션을 구성하는 오브젝트를 생성하고 관리하는 것이다. POJO로 만들어진 애플리케이션 클래스와 서비스 오브젝트들이 그 대상이다. 이렇게 컨테이너가 빈 이라고 불리는 오브젝트를 만들고 관리하는 것이 DI를 비롯한 스프링의 주요 기술을 적용하기 위한 전제조건이다.
컨테이너는 어떻게 자신이 만들 오브젝트가 무엇인지 알 수 있을까? 컨테이너 빈 설정 메타정보를 통해 빈의 클래스와 이름을 제공받는다. 빈을 만들기 위한 설정 메타정보는 파일이나 애노테이션 같은 리소스로부터 전용 리더를 통해 읽혀서 BeanDefinition 타입의 오브젝트로 변환된다. 이 BeanDefinition 정보를 IoC 컨테이너가 활용하는 것이다.
IoC 컨테이너가 직접 사용하는 BeanDefinition은 순수한 오브젝트로 표현되는 빈 생성 정보다. 따라서 그 정보가 담긴 리소스의 종류와 작성 방식에 독립적이다. 적절한 리더나 BeanDefinition 생성기를 사용할 수만 있다면 빈 설정 메타정보를 담은 소스는 어떤 식으로 만들어도 상관없다.

## 스코프 

### 스코프의 종류
스프링은 싱글톤, 르포토타입 외에 요청, 세션, 글로벌세션 애플리케이션 이라는 네 가지 스코르를 기본적으로 제공한다. 이 스코프는 모두 웹 환경에서만 의미가 있다. 이 네 가지 스코프 중에서 application을 제외한 나머지 세 가지 스코프는 싱글톤과 다르게 독립적인 상태를 저장해두고 사용하는데 필요하다. 서버에서 만들어지는 빈 오브젝트에서 상태를 저장해둘 수 있는 이유는 사용자마다 빈이 만들어지는 덕분이다.

### 요청 스코프
요청 스코프 빈은 하나의 웹 요청 안에서 만들어지고 해당 요청이 끝날 때 제거된다. 각 요청별로 독립적인 빈이 만들어지기 때문에 빈 오브젝트 내애 상태 값을 저장해둬도 안전하다. 요청 스코프 빈은 프로터타입과 마찬가지로 DL을 사용하는 것이 편리하지만 원한다면 DI를 이용할 수도 있다. 하나의 웹 요청을 처리하는 동안에 참조하는 요청 스코프 빈은 항상 동일한 오브젝트임이 보장된다 동시에 웹 요청에 달라지면 별도의 요청 스포크 빈이 만들어지기 때문에 동시에 여러 사용자가 많은 요청을 보내도 안전하다.
존재 범위 특징은 하나의 요청이 일어나느 메소드 파라미터로 전달되는 도메인 오브젝트나 DTO와 비슷하다. 그렇기 때문에 애플리케이션 코드에서 요청 스코프빈을 사용할 이유가 많지는 않다. 하나의 요청 안에서 유지되는 정보는 메소드 호출이 일어나는 동안 파라미터와 리턴 값으로 오브젝트를 전달해주면 된다.

요청 스코프 빈의 주요 용도는 애플리케이션 코드에서 생성한 정보를 프레임워크 레벨의 서비스나 인터셉터 등에 전달하는 것이다 또 애플리케이션 코드가 호출되기 전에 프레임워크나 인터셉터 등에서 생생한 정보를 애플리케이션 코드에서 시용할 때도 유용하다. 예를 들어 보안 프레임워크에서 현재 요청에 관련된 권한 정보를 요청 스코프 빈에 저장해뒀다가 필요한 빈에서 참조할게 할 수있다.

### 세션 스코프, 글로벌세션 스코프
HTTP 세션과 같은 존재 범위를 갖는 빈으로 만들어주는 스코프다. HTTP 세션은 사용자는 별로 만들어지고 블라우저를 닫거나 세션 타임이 종료될 때 까지 유지되기 때문에 로그인 정보나 사용자별 선택옵션 등을 저장해두기 유용하다. 하지만 HTTP 세션을 직접 이용하는 것 매우 번거롭고 귀찮은 일이고, 웹 환경 정보에 접근할 ㅜ 있는 계층에서만 가능한 작업이다. 서비스 계층이나 데이터 액세스 계층에서 HTTP 세션에 저장되는 정보를 웹 기술에 종속적이지 않은 오브젝트를 담아서 HTTP 세션에 직접 접근 가능한 프리젠테이션 계층과 서비스 계층 사이에서 주고 받아야 한다.
세션 스코프를 이요하면 이런 번러러움 없이도 HTTP 세션에 저장되는 정보를 모든 계층에서 안전하게 이용할 수 있다. 웹 페이지가 바뀌고 여러 요청을 거치는 동안에도 세션 스코프 빈은 계속 유지된다. HTTP 세션은 사용자별로 만들어지기 때문에 죽복의 위험도 없다.

### 애플리케이션 스코프
애플리케이션 스코프는 서블릿 컨텍스트에 저장되는 빈 오브젝트다. 서블릿 컨텍스트는 웹 애플리케이션 마다 만들어진다. 웹 애플리케이션마다 스프링 애플리케이션 컨텍스트도 만들어진다. 따라서 애플리케이션 스코프는 컨텍스트가 존재하는 동안 유지되는 싱글톤 스코프와 비슷한 존재 범위를 갖는다. 그렇다면 싱그톤 스코프를 사용하면 될 텐데 애플리케이션 스코프가 따로 존재하는 이유는 무엇일까? 그것은 드물지만 웹 애플리케이션과 애플리케이션 컨텍스트의 존재 범위가 다른 경우가 있기 때문이다.

## 스포프 빈의 사용 방법
애플리케이션 스코프를 제외한 나머지 세 가지 스코프는 프로토아입 빈과 마찬가지로 한 개 이상의 빈 오브젝트가 생성된다. 하지만 프로토아입 빈과 다르게 스프링 생성부터 초기화 DI, DL 그리고 제거까지 전 과정을 다 관리한다. 프로토타입과 다르게 컨테이너가 정확하게 언제 새로운 빈이 만들어지고 사용될지 파악할 수 있기 때문이다.

그러나 프로토타입과 마찬가질 빈마다 하나 이상의 오브젝트가 만들어쟈야 하기 떄믄에 싱글턴에 DI 해주는 방법으로 사용할 수 없다. 싱글톤에 DI 하면 오브젝트 생성이 한 번만 일어나기 때문이다. 애플리케이션 컨텍스트 초기화 중에서 모든 빈 오브젝트를 생성하고 DI를 진행한다. 그런데 요청 스코프 빈은 컨텍스트 초기화 시점에서는 만들어 질 수조차 없다. 아무런 웹 요청도 시작되지 않았기 때문이다. 따라서 요청 스코프 빈을 싱글톤빈에 DI 하면 컨텍스트 초기화 중에 에러가 발생할 것이다. **결국 스코프 빈 프로토타입 빈과 마찬가지로 Provider나 ObjectFactory 같은 DL방식으로 사용해야한다.**

## 정리
스프링의 컨테이너인 애플리케이션 컨텍스트를 이용해서 빈을 정의하고 사용하는 밥업을 알아봤다. 스프링은 매우 다양하고 세련된 IoC/DI 방법을 제공한다. 그만큼 선택의 폭이 크기 때문에 처음부터 컨테이너의 구성, 빈의 등록 방법, 빈의 의존관계를 정의하는 전략 등 치말하게 잘 세우고 개발을 시작할 필요가 있다. 자칫 여러 가지 방법론이 혼재되는 경우 코드와 설정정보를 이해하고 관리하기 매우 힘들어 질수 있다.

* 스프링 애플리케이션은 POJO 클래스와 빈 설정 메타정보로 구성된다.
* 빈 설정 메타정보는 특성 포맷의 파일이나 리소트에 종속되지 앟는다. 필요하다면 새로운 설정정보 작성 방법을 얼마든지 만들어 사용할 수 있다.
* 스프링의 빈 등록 방법은 크게 XML과 빈 자동인식, 자바 코드 세가지로 구분할 수 있다.
* 스프링의 빈 오브젝트관계 설정 밥업은 XML, 애노테이션, 자바 코드로 구분할 수있다.
* 프로퍼티 값은 빈에 주입되는 빈 오브젝트가 아닌 정보다.
* 프로퍼티 값 중에서 환경에 따라 자주 바뀌는 곳은 프로퍼티 파일과 같은 별도의 리소스형태로 분리해노는 것이 좋다.
* 스프링은 애노테이션과 자바 코드를 이용한 빈 메타정보 작성 기능을 반전시켜서 자바 코드만으로 스프링 애플리케이션의 모든 빈 설정이 가능하게 해준다.
* 스프링의 프로퍼파일과 프로퍼티 소스로 이뤄진 런타임 환경 추상화 기능을 이용하면 환경에 따라 달라지는 빈 구성과 속성 지정 문제를 쉽게다를 수 있다.


# 2장 데이터 액세스 기술

## 공통 개념

### DAO 패턴
데이터 엑세스 계층은 DAO 패턴이라는 불리는 방식으로 분리하는 것이 원칙이다. 비지느스 로직이 없거나 단순한 DAO와 서비스 계층을 통합할 수도 있다. 하지만 의미 있는 비지니스 로직을 가진 엔터프라이즈 애플리케이션 이라면 데이터 액세스 계층을 DAO 패턴으로 분리해야 한다.

DAO 패턴은 DTO 또는 도메인 오브젝트만을 사용하는 인터페이스를 통해 데이터 액세스 기술을 외부에 노출하지 않도록 만드는 것이다. 따라서 DAO는 구현 기술에 대한 정보를 외부에 공개해서는 안된다. 이를 통해 DAO를 사용하는 코드에 영향을주지 않고 데이터베이스 액세스 기술을 변경하거나 하나 이상의 데이터 액세스 기술을 혼잡해서 사용할 수 있게 해준다. **가장 중요한 장점은 DAO를 이용하는 서비스 계층의 코드를 기술이나 환경에 종속되지 않고 순수한 POJO로 개발할 수 있다는 것이다.** DAO 인터페이스는 기술과 상관 없는 단순한 DTO나 도메인 모델만을 사용하기 때문에 언제든지 목오브젝트 같은 테스트 대역 오브젝트로 대체해서 단위 테스트를 작성할 수 있다.

### DAO 인터페이스와 DI
DAO는 인터페이스를 이용해서 접근하고 DI 되도록 만들어야 한다. DAO 인터페이스에는 구체적인 데이터 액세스 기술과 관련된 API나 정보도 노출하지 않는다. 
인터페이스를 만들때 관습적으로 DAO 클래스의 모든 pulbic 메소드를 추가하지 않도록 주의하자. DAO를 사용하는 서비스 계층ㅇ코드에 의미있는 메소드만 인터페이스로 공해야하된다. 특정 데이터베이스 액세스 기술에서만 의미있는 DAO 메소드의 이름을 피하도록한다. JPA는 엔티ㅣ의 등록과 수정을 위해 persist(), meger() 등의 메소드를 사용한다. DAO를 만든다고 했을 경우 add, update 같은 이름을 선택하자

## DataSoruce
JDBC를 통해서 DB를 사용하면 Connection 타입의 DB 연결 오브젝트가 필요하다. Connection은 모든 데이터 액세스 기술에 사용되는 필수 리소스다. 사용자의 요청이 빈번하게 일어나는 엔터프라이즈 환경에서 각 요청마다 Connection을 새롭게 만들고 종료시킨다. 애플리케이션 서버와 DB 사이의 실제 컨넥션을 매번 새롭게 만드는 건 비효율적이고 성능을 떨어뜨린다. 그래서 보통 미리 정해진 개수만큼 DB 컨낵센을 풀에 준비해두고, 애플리케이션이 요청할 때 마다 풀에서 꺼내서 하나씩 할당해주고 돌려받아서 풀에 넣는식의 풀링 기법을 이용한다. 







