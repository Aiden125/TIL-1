> 해당 내용은 [코틀린을 다루는 기술](http://www.yes24.com/Product/Goods/89564200) 을 보고 정리한 내용 입니다.

# 1장 프로그램을 더 안전하게 만들기

## 프로그램의 함정

프로그램을 더 안전하게 만들기 위한 다음 몇 가지 방법을 배운다

* 가변 참조(변수) 사용을 피하고ㅓ, 상태 변이를 피할 수 없는 경우에는 그 부분을 추상화하라
* 제어 구조를 피하라
* 효과(effect, 외부 세계와의  상호 작용을 말한다)를 여러분이 작성하는 프로그램의 일부 영역안에서만 일어나도록 제한하라. 이 말은 프로그램을 작성할 때 일부 한정된 영역을 제외한 나머지 부분을 콘솔 등의 장치에 출력하거나 파일, 데이터베이스, 네트워크 등의 장치에 데이터를 쓰는 등의 행위를 하지 말라는 뜻이다.
* 예외를 던지지 말라, **예외를 던지는 것은 무조건 분기(GOTO)의 현대적인 변형이라고 할 수 있다.** 이로 인해 프로그램이 스파게티 코드가 될 수 있다. 스파게티 코드라는 말은 프로그램 흐름이 어디서 시작하는지 알 수 있지만, 어디로 흘러가는지 제대로 따라갈수 없다는 뜻이다.

### 안전하게 부수 효과 처리하기
일부 메서드는 값을 반환하낟, 일부 메서드는 세계의 상태를 변경한다. 일부 메서드는 값을 변환하는 동시에 상태를 변경하기도 한다. **값을 반환하는 메서드나 함수가 외부 상태를 변경하는 경우를 부수 효과(side effect) 라고 한다.** 이런 부수효과를 사용하는 프로그램은 잘못된 것이다. 이런 부수 효과는 `단일 책임 원칙`이라는 실무 지침을 위배하는 좋지 못한 기법입니다.

### 참조 추명성으로 프로그램을 더 안전하게 만들기

**외부 세계의 상태를 변경하지 않고 외부 상태에 의존하지도 않은 코드를 일컬어 참조 투명(referentially transparent) 하다고 한다.** 참조 투명한 코드에는 몇 가지 흥미로운 특성이 있다.

* 참조 투명한 코드는 **자기 완 결적이다.** 어떤 문맥에서나 그 코드를 사용할 수 있다. 단지 올바른 인자를 그 코드에 제공하기만 하면 된다.
* 참조 투명한 코드는 **결정적이다.** 참조 투명한 코드는 인자가 같으면 항상 결과도 같기 때문에 여러분의 놀라게하는 일이 없다. 하지만 참조 투명한 코드도 잘못된 결과값을 돌려줄 수 는 있다. 그렇지만 적어도 같은 인자에 대해 항상 같은 결과를 보장한다.
* 참조 투명한 코드는 **절대 예외를 던지지 않는다.** 다만 참조 투명한 코드도 메모리 부족 오류나 스택 오버프로 오류를 발생시킬 수 있다. 하지만 이런 오류는 프로그램에 버그가 있음을 뜻한다. 여러분이 제공하는 API를 사용하는 쪽에서 처리할 수 있는 요류사황이 아니다.
* 참조 투명한 코드는 **예기치 않게 다른 코드가 실패하는 상황을 만들지 않는다.** 참조 투명한 코드는 인자를 변경하거나 다른 어ㅚ부 데이터를 변경하지 않으며, 그에 따라 코드를 호출하는 쪽으, 데이터가 오염되거나 동시 접근으로 인해 오류가 발생하는 경우가 없다.
* 참조 투명한 코드는 **자신이 제대로 동작하는지 위해 외부 장치에 의존하지 않는다.** 차조 투명한 ㅗㅋ드는 외부 장치(데이터베이스 파일 시스템, 네트워크)를 사용할 수 없가나, 외부 장치가 너무 느리거나 고장 나서 코드가 계속 대기 상태에 머무는 경우가 없다.

## 안전한 프로그래밍의 이점

* 프로그래밍이 결정적이기 때문에 프로그램을 더 추론하기 더 쉽다. 입력이 같으면 항상 출력도 같다. 따라서 대대적으로 테스트해도 여전히 그 프러그램이 예기치 않은 조건에서 깨질수 있는지 확인할 수 없는 비결정적인 프로그램과 달리 프로그램을 올바르게 증명할 수있다.
* 프로그램을 더 쉽게 테스트할 수 있다. 부수 효과가 없으므로 테스트하면서 프로그램 **컴포넌트를 외부와 격리하기 위해 쓰는 Mock을 사용할 필요가 없다.**
* 프로그램을 더 모듈화 할 수 있다. 
* 프로그램을 훨씬 쉽게 할성하고 재조합할 수 있다.
* 공유 상태 변이를 피하므로 프로그램이 태생적으로 스레드 안전하다. 