> [스프링 5.0 마스터](http://acornpub.co.kr/book/mastering-spring-5.0)를보고 정리한 자료 입니다.


# 스프링 클라우드

* 스프링 클라우드 컨피그 서버로 중앙 마이크로 서비스 구성 구현하기
* 스프링 클라우드 버스를 사용해서 마이크로 서비스 인스턴스 간 구성을 동기화 하기
* 페인을 사용해 선언적 REST 클라이언트 만들기
* 립본을 사용해 클라이언트 -사이드 로드 밸런싱 구현하기
* 유레카를 사용해서 네임 서버 구현하기
* 주울을 이용해서 API 게이트이 구현하기
* 스프링 클라우드 슬루스 와 잡킨을 사용해 분산된 추적 구현하기
* 히스트릭스를 사용해서 내결함성 구현하기



* 스프링 클라우드 컨피그 : 서로 다른 환경에서 소로 다른 마이크로서비스에 대해 중앙 집중식 외부 구성을 기능하게 한다.
* 스프링 클라우드 넷플릭스 : 넷플릭스는 마이크로서비스 아키텍처의 얼리어답터 중하나다. 다수의 내부 넷플릭스 프로젝트가 스프링 클라우드 넷플릭스 산하에 오픈소스로 공개됐다.
* 스프링 클라우드 버스 : 경량의 메시지 브로커와 마이크로서비스의 통합을 좀더 쉽게 구축할 수 있다.
* 스프링 클라우드 슬루스 : 집킨과 함께 분산 추석 솔루션을 제공한다.
* 스프링 클라우드 테이터 플로 :  마이크로 서비스 애플리케이션을 중심으로 결집된 기능을 제공한다. DSL, GUI 및 REST API를 제공한다.
* 스프링 클라우드 스트림 : 스프링 기반 애플리케이션을 아파치 카프카, 레빗MQ같은 메시지 브로커와 통합하는 간단한 선언적 프레임워크를 제공한다.

## 스프링 클라우드 넷플릭스

스프링 클라우드 넷플릭스는 자동 환경 설정과 스프링 환경 및 다른 스프링 프로그래밍 모델 관용구에 대한 바인딩을 통해 스프링 부트 애플리케이션을 위한 넷플릭스 OSS 통합을 제공한다.

* 유레카 : 마이크로서비스에 대한 서비스 등록 및 검색 기능을 제공하는 네임 서버.
* 히스트릭스 : 서킷 브레이커를 통해 내결함성 마이크로 서비스를 구축할 수 있는 기능으로, 대시 보드를 제공한다.
* 페인: 선언적인 REST 클라이언트를 사용하면, JAX-RS 및 스프링 MVC로 작성된 서비스를 쉽게 호출 할 수 있다.
* 립본 : 클라이언트 기준 로드 밸런싱 기능을 제공한다.
* 주울 : 라우팅, 필터링, 인증 및 보안과 같은 일반적인 API 게이트웨이 기능을 제공한다.


## 중앙 집중식 마이크로서비스 구성
큰 모놀리식 애플리케이션 세트 대신 서로 상호작용하는 작은 마이크로서비스로 구성된다. 각 마이크로서비스는 일반적으로 개발, 테스팅, 로드 테스트, 스테이징 및 프로덕션과 같은 여려 환경에 배포된다. **서로 다른 환경에 여러 마이크로서비스 인스턴스가 있을 수 있다.**

일반적으로 애플리케이션의 구성에는 다음이 포함된다.

* 데이터베이스 구성 : 데이터베이스 연결하는 데 필요한 세부 정보
* 메시지 브로커 : AMQP 또는 이와 유사한 자원에 연결하는 데 필요한 구성
* 외부 서비스 구성 : 마이크로서비스가 필요한 기타 서비스
* 마이크로서비스 구성 : 마이크로서비스의 비지니스 로직과 관련된 인반적인 구성


마이크로서비스의 각 인스턴스는 자체 데이터베이스, 다른 데이터베이스, 다른 외부 서비스 등을 가질 수 있다. 마이크로서비스가 5개의 환경에 배포되고 각 환경에 4개의 인스턴스가 있는 경우, 마이크로서비스는 총 20개의 서로 다른 구성을 가질 수 있다.


### 해결책
중앙 집중식 구성 서버는 모든 다른 마이크로서비스에 속한 모든 구성을 보우한다. 이렇게 하면 배포 가능한 애플리케이션과는 별도로 구성을 유지하는데 도움이 된다.

중요한점은 서로 다른 환경에 대한 중앙 집중식 구성 서버의 개별 인스턴스가 있는지의 여부를 결정하는 것이다. 일반적으로 프로덕션 구성에 대한 액세스가 다른 환경에 비해 더 제한적이길 원한다.

### 스프링 클라우드 컨피그
스프링 클라우드 컨피그는 중앙 집중식 마이크로서비스 구성을 지원한다. 여기서 두 가지 중요한 구성 요소의 조합이다.

* 스프링 클라우드 컨피그 서버 : 버전 관리 리포지토리로 백업된 중앙 집중식 구성 노출을 지원한다.
* 스프링 클라우드 컨피그 클라이언트 : 애플리케이션이 스프링 클라우드 컨피그 서버에 연결하도록 지원한다.


![](https://github.com/cheese10yun/spring-msa-demo/raw/master/assets/msa-config-server.png)




---
## Spring Clound Netflix

> 스프링 클라우드 넷플릭스는 자동 환경 설정과 스프링 환경 및 다른 스프링 프로그래밍 모델 관용구에 대한 바인딩을 통해 스프링 부트 애킬리케이션을 위한 넷플릭스 OSS 통합 제공한다.

스프링 클라우드는 넷플릭스의 포괄적 범위 아래에 있는 중요한 프로젝트 중 일부는 다음과 같다.

* 유레카: 마이크로서비스에 대한 서비스 ㅁ등록 및 검색 기능을 제공하는 네임 서버다.
* 히스트릭스: 서킷 브레이커를 통해 내결함성 마이크로서비스를 구축할 수 있는 기능으로, 대시 보드를 제공한다.
* 페인: 선언적인 REST 클라이언트를 사용하면 JAX-RS 및 스프링 MVC로 작성된 서비스를 쉽게 호출할 수 있다.
* 립본: 클라이언트 기준 로드 밸런싱 기능을 제공한다.
* 주울: 라우팅, 필터링, 인증 및 보안과 같은 일반적인 API 게이트웨이 기능을 제공한다. 맞춤 규식 및 필터로 확장 할 수 있다.

## Config Server
스프링 클라우드 컨피그는 중앙 집중식 마이크로 서비스 구성을 지원한다.

* 스프링 클라우드 컨피그 서버 : 버전 관리 리포지토리로 백업 된 중앙 집중식 구성을 지원한다.
* 스프링 클라우드 컨피그 클라어은트: 애플리케이션이 스프링 클라우드 컨피그 서버에 연결하도록 지원한다.

![msa-config-server](https://github.com/cheese10yun/spring-msa-demo/raw/master/assets/msa-config-server.png)

## Cloud Bus
스프링 클라우드 버스는 마이크로서비스를 카프카 및 래빗MQ 같은 경량 메시지 브로커에 연결한다

### 필요성
마이크로 서비스에 구성을 변경하려는 하려면 프로덕션 환경에 실행 중인 마이크로서비스 A의 인스턴스가 5개가 있다고 가정하면, 구성을 긴급히 변경해야할 때 `http://localhost:8080/refesh` POST 요청을 호출해야한다. 

마이크로서비스가 A 다섯 가지 실행된다. 구성 변경은 URL이 실행되는 마이크로 서비스 A의 인스턴스에만 반영된다. 다른 3개의 인스턴스는 새로 고침 요청이 실행 될 때까지 구성 변경 사항을 받지 못한다.

### 스프링 클라우드 버스를 사용해 구성 변경 전파
해결 책은 스프링 클라우드 버스를 사용해 래빗MQ와 같은 메시지 브로커를 통해 구성 변경 사항을 여러 인스턴스에 전달하는 것이다.
![msa-cloud-bus](https://github.com/cheese10yun/spring-msa-demo/raw/master/assets/msa-cloud-bus.png)

마이크로서비스 인스턴스 중 하나에 새로 고침이 호출되면, 스프링 클라우드 버스는 모든 마이크로 서비스 인스턴스에 변경 이벤트를 전달한다. 마이크로서비스는 인스턴스는 변경 이벤트 수신 시 구성 서버에 업데이트된 구성을 요청한다.